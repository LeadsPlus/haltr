<div class="haltrinvoice">
  <h3>
    <%= "#{l(:label_invoice)} #{@invoice.number} (#{l("state_#{@invoice.state}")})" %>
  </h3>
  <ul class="toolbox secondary">
    <li><%= link_to l(:button_edit), {:action=>'edit',:id=>@invoice} %></li>
    <li><%= link_to l(:button_delete), {:action=>'destroy',:id=>@invoice}, :confirm => l(:text_are_you_sure), :method => :delete %></li>
    <li><%= change_state_link(@invoice) %></li>
    <li><%= link_to "#{l(:save_invoice)} PDF", :action=>'pdf', :id=>@invoice %></li>
    <% if @invoice.can_be_exported? %>
      <li><%= link_to "#{l(:label_send)} (#{l(@invoice.client.invoice_format)})" , :action=>'send_invoice', :id=>@invoice %></li>
    <% end -%>
    <% if @invoice.state?(:sent) -%>
      <li><%= link_to l(:receive_payment), :controller => 'payments', :action => 'new', :id => @project, :invoice_id => @invoice %></li>
    <% end -%>

    <% if @invoice.invoice_template_id and @invoice.invoice_template -%>
      <li><%= link_to "#{l(:show_template)} #{@invoice.invoice_template.id}", {:controller=>'invoice_templates',:action => 'show', :id => @invoice.invoice_template_id } %></li>
    <% else -%>
      <li><%= link_to l(:generate_template_from_invoice), {:controller=>'invoice_templates',:action=>'new_from_invoice',:id=>@invoice} %></li>
    <% end -%>

  </ul>

  <div class="client-invoices">
    <h3><%=l(:recipients)%></h3>
    <ul class="secondary">
      <li>
      <%= link_to "#{@invoice.client.name} &lt;#{@invoice.client.email}&gt;", :controller =>'clients' ,:action=>'edit', :id=>@invoice.client %>
      </li>
      <% @invoice.recipients.each do |person| -%>
        <li>
        <%= link_to "#{person.first_name} #{person.last_name} &lt;#{person.email}&gt;", :controller =>'people' ,:action=>'show', :id=>person %>
        </li>
      <% end -%>
    </ul>
  </div>

  <% if @invoices_not_sent.any? -%>
    <div class="client-invoices">
      <h3><%=l(:open_invoices)%></h3>
      <p style="padding:7px 20px;">
      <% @invoices_not_sent.each do |invoice| -%>
        <%=link_to invoice.number, :action => 'show', :id => invoice %><%= ", " unless invoice == @invoices_not_sent.last %>
      <% end -%>
      </p>
    </div>
  <% end -%>
  <% if @invoices_sent.any? -%>
    <div class="client-invoices">
      <h3><%=l(:pending_invoices)%></h3>
      <p style="padding:7px 20px;">
      <% @invoices_sent.each do |invoice| -%>
        <%=link_to invoice.number, :action => 'show', :id => invoice %><%= ", " unless invoice == @invoices_sent.last %>
      <% end -%>
      </p>
    </div>
  <% end -%>
  <% if @invoices_closed.any? -%>
    <div class="client-invoices">
      <h3><%=l(:closed_invoices)%></h3>
      <p style="padding:7px 20px;">
      <% @invoices_closed.each do |invoice| -%>
        <%=link_to invoice.number, :action => 'show', :id => invoice %><%= ", " unless invoice == @invoices_closed.last %>
      <% end -%>
      </p>
    </div>
  <% end -%>

</div>
