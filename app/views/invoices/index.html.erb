<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'haltr', :plugin => 'haltr' %>
<% end %>

<div class="contextual">
  <%= link_to l(:label_invoice_new), {:action => 'new', :id => @project}, :class => 'icon icon-add' %>
</div>

<h2><%= controller.controller_name == "invoice_templates" ? l(:label_invoice_template_plural) : l(:label_invoice_plural)%></h2>

<div id="filter" class="invoiceFilter">
  <% form_tag({}, :method => :get) do %>
    <fieldset><legend><%= l(:label_filter_plural) %></legend>
      <table>
        <tr>
          <th><%= l(:label_invoice_status) %>:</th>
          <td>
            <%= check_box_tag("status_all", "1", params["status_all"]) %> <span style="font-weight:bold;">All</span>
            <% Invoice::STATUS_LIST.each do |id,txt| -%>
              <%= check_box_tag("status_#{id}", "1", params["status_#{id}"]) %> <%=txt%>
            <% end -%>
          </td>
        </tr>
        <tr>
          <th><%=l(:label_from)%>:</th>
          <td><%= text_field_tag :date_from, (params[:date_from].nil? ? Date.new(Date.today.year) : params[:date_from]), :size => 10 %><%= calendar_for('date_from') %></td>
        </tr>
        <tr>
          <th><%=l(:label_to)%>:</th>
          <td><%= text_field_tag :date_to, (params[:date_to].nil? ? Date.today : params[:date_to]), :size => 10 %><%= calendar_for('date_to') %></td>
        </tr>
        <tr>
          <th><%= l(:label_client) %>:</th>
          <td><%= collection_select(nil, :client_id, @project.clients, :id, :name, {:include_blank => true, :selected => params[:client_id]}) %></td>
        </tr>
        <tr>
          <th></th>
          <td><%= submit_tag l(:button_apply), :class => "small", :name => nil %></td>
        </tr>
      </table>
    </fieldset>
  <% end %>
</div>


<table class="list" id="invoices">
  <thead>
    <%= sort_header_tag('status', :caption => l(:field_status)) %>
    <%= sort_header_tag('date', :caption => l(:field_date)) %>
    <%= sort_header_tag('number', :caption => l(:field_number)) %>
    <%= sort_header_tag('clients.name', :caption => l(:field_client)) %>
    <th><%= l(:label_paid) %></th>
    <th><%= l(:label_total) %></th>
  </thead>
  <tbody>
    <% for invoice in @invoices -%>
      <tr class="user <%= cycle("odd", "even") %>" onclick="javascript: document.location = '<%=url_for(:action=>'showit', :id=>invoice)%>'">
        <td align="center"><%= change_status_link(invoice) %></td>
        <td align="center"><%=h invoice.date %></td>
        <td align="center"><%= link_to h(invoice.number), {:action=>'showit',:id=>invoice}, :class => 'icon icon-show' %></td>
        <td><%=link_to h(invoice.client), {:controller => 'clients', :action => 'edit', :id => invoice.client} %></td>
        <td align="right"><%= invoice.total_paid %></td>
        <td align="right"><%= invoice.total %></td>
      </tr>
    <% end -%>
  </tbody>
</table>

<p class="pagination"><%= pagination_links_full @invoice_pages, @invoice_count %></p>

<% html_title(l(:label_invoice_plural)) -%>

<% content_for :sidebar do %>
  <%= render :partial => 'common/sidebar' %>
<% end %>
