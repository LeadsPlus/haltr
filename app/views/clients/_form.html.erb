<%= error_messages_for 'client' %>
<%
  ajax_opts = {
    :method => :get,
    :url => url_for({:controller=>'clients', :action=>'check_cif',:id=>@project.id, :client => @client}),
    :with => "'value=' + this.value",
    :update => 'cif_info'
  }
  short ||= false
-%>

<div id="cif_info">
  <%= render :partial => "clients/cif_info", :locals => { :client => @client, :company => @client.company } %>
</div>


<fieldset>
  <legend><%=l(:label_company)%></legend>
  <div class="seccio grup">
    <div class="col span-1-de-2">
      <% if @client.linked? -%>
        <%= f.text_field :taxcode, :required => true, :readonly => @client.linked? %>
      <% elsif !short -%>
        <%= f.text_field :taxcode, :required => true, :onblur => remote_function(ajax_opts) %>
      <% else -%>
        <%= f.text_field :taxcode, :required => true %>
      <% end -%>
    </div>
    <div class="col span-1-de-2">
      <%= f.text_field :company_identifier %>
    </div>
  </div>
  <div class="seccio grup">
    <div class="col span-1-de-3">
      <%= f.text_field :name, :required => true, :readonly => @client.linked? %>
    </div>
    <div class="col span-1-de-3">
      <%= f.text_field :email, :required => true, :readonly => @client.linked? %>
    </div>
    <div class="col span-1-de-3">
      <%= f.text_field :website %>
    </div>
  </div>
  <% if short -%>
    <p id="show_full_form">
    <%= link_to_function("--- #{l(:show_full_form)} ---", "$('.client_hiden_fields').show(); $('#show_full_form').hide()") %>
    </p>
  <% end -%>
  <div class="client_hiden_fields" style="<%= short ? "display:none;" : "" %>">
    <% if short -%>
      <p><%= link_to_function("--- #{l(:hide_full_form)} ---", "$('.client_hiden_fields').hide(); $('#show_full_form').show()") %></p>
    <% end -%>
    <div class="seccio grup">
      <div class="col span-2-de-2">
        <%= f.text_field :address, :readonly => @client.linked? %>
      </div>
    </div>
    <div class="seccio grup">
      <div class="col span-2-de-2">
        <%= f.text_field :address2, :readonly => @client.linked? %>
      </div>
    </div>
    <div class="seccio grup">
      <div class="col span-1-de-4">
        <%= f.text_field :postalcode, :required => true, :readonly => @client.linked? %>
      </div>
      <div class="col span-1-de-4">
        <%= f.text_field :city, :readonly => @client.linked? %>
      </div>
      <div class="col span-1-de-4">
        <%= f.text_field :province, :readonly => @client.linked? %>
      </div>
      <div class="col span-1-de-4">
        <%= f.label_for_field :country, :required => true %>
        <%= f.iso_country_select :country, valid_languages, :readonly => @client.linked? %>
      </div>
    </div>
    <% if @client.linked? -%>
      <div class="seccio grup">
        <div class="col span-1-de-3">
          <%= f.text_field :language, :value => l(:general_lang_name,:locale => @client.language), :readonly=>true %>
        </div>
        <div class="col span-1-de-3">
          <%= f.select :currency, currency_options_for_select, :required => true %>
        </div>
        <div class="col span-1-de-3">
          <%= f.text_field :invoice_format, :value => ExportChannels.l(@client.invoice_format), :readonly=>true %>
        </div>
      </div>
    <% else -%>
      <div class="seccio grup">
        <div class="col span-1-de-3">
          <%= f.select :language, lang_options_for_select %>
        </div>
        <div class="col span-1-de-3">
          <%= f.select :currency, currency_options_for_select, :required => true %>
        </div>
        <div class="col span-1-de-3">
          <%= f.select :invoice_format, ExportChannels.for_select(@project) %>
        </div>
      </div>
    <% end -%>
</fieldset>

<div class="client_hiden_fields" style="<%= short ? "display:none;" : "" %>">
<fieldset>
  <legend><%=l(:bank_info)%></legend>
  <div class="seccio grup">
    <div class="col span-1-de-3">
      <%= f.text_field :bank_account, :size => 30 %>
    </div>
    <div class="col span-1-de-3">
      <%= f.text_field :iban, :size => 30 %>
    </div>
    <div class="col span-1-de-3">
      <%= f.text_field :bic, :size => 30 %>
    </div>
  </div>

  <% unless @client.linked? -%>
    <div class="seccio grup">
      <div class="col span-1-de-2">
        <% disabled = [] ; disabled << Invoice::PAYMENT_TRANSFER if @project.company.bank_account.blank? -%>
        <%= f.select(:payment_method, Invoice.payment_methods, {:disabled=>disabled}, :onchange => "payment_method_changed('client');") %>
        <% if @client.payment_method == 13 -%>
          <%= f.text_area(:payment_method_text, :cols => 40, :rows => 2, :no_label => true, :style => "height: 6em;") %>
        <% else -%>
          <%= f.text_area(:payment_method_text, :cols => 40, :rows => 2, :no_label => true, :style => "height: 6em; display: none;") %>
        <% end -%>
      </div>
      <div class="col span-1-de-2">
        <%= f.select(:terms, Terms.for_select, {}) %>
      </div>
    </div>
  <% end -%>
</fieldset>

<% if User.current.admin? or User.current.allowed_to?(:send_peppol, @project) -%>
  <fieldset>
    <legend>PEPPOL</legend>
    <div class="seccio grup">
      <div class="col span-1-de-2">
        <%= f.select :schemeid, Peppol::SCHEMEIDS %>
      </div>
      <div class="col span-1-de-2">
        <%= f.text_field :endpointid %>
      </div>
  </fieldset>
<% end -%>
</div>
